{"version":3,"sources":["webpack:///./src/apis/socket.js","webpack:///./src/views/PublicMessage.vue?5623","webpack:///./src/assets/image/send.svg","webpack:///./src/components/MessageBox.vue?69fa","webpack:///src/components/MessageBox.vue","webpack:///./src/components/MessageBox.vue?3945","webpack:///./src/components/MessageBox.vue","webpack:///./src/assets/image/conversation.svg","webpack:///./src/components/MessageBox.vue?b2fa","webpack:///./src/views/PublicMessage.vue?494b","webpack:///src/views/PublicMessage.vue","webpack:///./src/views/PublicMessage.vue?e13a","webpack:///./src/views/PublicMessage.vue"],"names":["getPublicRoom","apiHelper","get","createPrivateRoom","userId","post","getPrivateRoom","getNotification","getRoom","roomId","getRoomsByUser","getAvailableUsers","getUnread","module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","on","updateScroll","_v","currentChat","_s","name","account","ref","messageList","length","_l","item","type","key","id","text","class","currentUser","UserId","attrs","_f","avatar","message","createdAt","directives","rawName","value","expression","undefined","domProps","$event","indexOf","_k","keyCode","sendMessageHandler","target","composing","staticRenderFns","mixins","components","props","Object","default","Array","required","atPublic","Boolean","data","isProcessing","updated","methods","messageCheck","icon","title","messageCheckResult","console","log","sendMessage","messageMode","newMessage","$socket","emit","toggleIsProcessing","$refs","scrollTop","scrollHeight","watch","currentRoomId","computed","component","onlineUsersCount","_e","user","onlineUsers","sockets","push","Date"],"mappings":"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","file":"js/chunk-4a2d9787.bc51ae73.js","sourcesContent":["import { apiHelper } from './../utils/helpers'\n\nexport default {\n  getPublicRoom() {\n    // getPublicRoom\n    return apiHelper.get('/rooms/4')\n  },\n  createPrivateRoom(userId) {\n    return apiHelper.post('/rooms', { userId })\n  },\n  // 未完成\n  getPrivateRoom(userId) {\n    return apiHelper.get(`/rooms/${userId}`)\n  },\n  getNotification() {\n    return apiHelper.get('/rooms/notifications')\n  },\n  getRoom(roomId) {\n    return apiHelper.get(`/rooms/${roomId}`)\n  },\n  getRoomsByUser() {\n    // get all chats by rooms\n    return apiHelper.get('/rooms')\n  },\n  getAvailableUsers() {\n    return apiHelper.get('rooms/availableUsers')\n  },\n  getUnread() {\n    return apiHelper.get('/private/unread')\n  }\n}","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicMessage.vue?vue&type=style&index=0&id=3d63ecae&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/send.44ccdf6b.svg\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"messageBox\"},[(_vm.atPublic)?[_c('div',{staticClass:\"title\",on:{\"click\":_vm.updateScroll}},[_c('h1',[_vm._v(\"公開聊天室\")])])]:[(_vm.currentChat.name)?_c('div',{staticClass:\"title private\"},[_c('h1',[_vm._v(_vm._s(_vm.currentChat.name ? _vm.currentChat.name : \"UserName\"))]),_c('p',[_vm._v(\"@\"+_vm._s(_vm.currentChat.account ? _vm.currentChat.account : \"UserAccount\"))])]):_c('div',{staticClass:\"title noChat\"},[_c('h1',[_vm._v(\"開啟聊天！\")])])],_c('div',{ref:\"messageList\",staticClass:\"container\"},[_c('ul',{staticClass:\"messageList\"},[(_vm.isProcessing)?_c('Spinner'):[(!_vm.messageList.length)?_c('div',{staticClass:\"emptyList\"},[_c('img',{attrs:{\"src\":require(\"../assets/image/conversation.svg\"),\"alt\":\"\"}})]):_vm._l((_vm.messageList),function(item){return [(item.type === 0)?_c('li',{key:item.id,staticClass:\"actionItem\"},[_c('p',[_vm._v(_vm._s(item.text))])]):_c('li',{key:item.id,staticClass:\"messageItem\",class:{ currentUser: item.UserId === _vm.currentUser.id }},[_c('div',{staticClass:\"mainContent\"},[_c('div',{staticClass:\"avatar\"},[_c('img',{attrs:{\"src\":_vm._f(\"emptyImageFilter\")(item.avatar),\"alt\":\"\"}})]),_c('div',{staticClass:\"textContainer\"},[_c('div',{staticClass:\"text\"},[_vm._v(\" \"+_vm._s(item.message)+\" \")])])]),_c('div',{staticClass:\"textTime\"},[_vm._v(_vm._s(_vm._f(\"fromNow\")(item.createdAt)))])])]})]],2)]),_c('div',{staticClass:\"meesagePanel\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.message),expression:\"message\"}],attrs:{\"id\":\"textInput\",\"placeholder\":\"輸入訊息...\",\"type\":\"text\",\"maxlength\":\"160\",\"required\":\"\",\"disabled\":_vm.currentChat.userId === undefined},domProps:{\"value\":(_vm.message)},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.sendMessageHandler($event)},\"input\":function($event){if($event.target.composing){ return; }_vm.message=$event.target.value}}}),_c('button',{staticClass:\"btn sendBtn\",attrs:{\"disabled\":_vm.currentChat.userId === undefined,\"type\":\"submit\"},on:{\"click\":_vm.sendMessageHandler}},[_c('img',{attrs:{\"src\":require(\"../assets/image/send.svg\"),\"alt\":\"\"}})])])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"messageBox\">\n    <template v-if=\"atPublic\">\n      <div class=\"title\" @click=\"updateScroll\">\n        <h1>公開聊天室</h1>\n      </div>\n    </template>\n    <template v-else>\n      <div class=\"title private\" v-if=\"currentChat.name\">\n        <h1>{{ currentChat.name ? currentChat.name : \"UserName\" }}</h1>\n        <p>@{{ currentChat.account ? currentChat.account : \"UserAccount\" }}</p>\n      </div>\n      <div v-else class=\"title noChat\">\n        <h1>開啟聊天！</h1>\n      </div>\n    </template>\n\n    <div class=\"container\" ref=\"messageList\">\n      <ul class=\"messageList\">\n        <Spinner v-if=\"isProcessing\"></Spinner>\n        <template v-else>\n          <div v-if=\"!messageList.length\" class=\"emptyList\">\n            <img src=\"../assets/image/conversation.svg\" alt=\"\" />\n          </div>\n          <!--  -->\n          <template v-else v-for=\"item of messageList\">\n            <!-- actionItem -->\n            <li v-if=\"item.type === 0\" class=\"actionItem\" :key=\"item.id\">\n              <p>{{ item.text }}</p>\n            </li>\n\n            <!-- messageItem: others -->\n            <li\n              v-else\n              class=\"messageItem\"\n              :key=\"item.id\"\n              :class=\"{ currentUser: item.UserId === currentUser.id }\"\n            >\n              <div class=\"mainContent\">\n                <div class=\"avatar\">\n                  <img :src=\"item.avatar | emptyImageFilter\" alt=\"\" />\n                </div>\n                <div class=\"textContainer\">\n                  <div class=\"text\">\n                    {{ item.message }}\n                  </div>\n                </div>\n              </div>\n              <div class=\"textTime\">{{ item.createdAt | fromNow }}</div>\n            </li>\n          </template></template\n        >\n      </ul>\n    </div>\n    <div class=\"meesagePanel\">\n      <input\n        @keyup.enter=\"sendMessageHandler\"\n        id=\"textInput\"\n        placeholder=\"輸入訊息...\"\n        type=\"text\"\n        v-model=\"message\"\n        maxlength=\"160\"\n        required\n        :disabled=\"currentChat.userId === undefined\"\n      />\n      <button\n        :disabled=\"currentChat.userId === undefined\"\n        type=\"submit\"\n        class=\"btn sendBtn\"\n        @click=\"sendMessageHandler\"\n      >\n        <img src=\"../assets/image/send.svg\" alt=\"\" />\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Spinner from \"./Common/Spinner\";\nimport { fromNowFilter } from \"../utils/mixins\";\nimport { emptyImageFilter } from \"../utils/mixins\";\nimport { Toast } from \"../utils/helpers\";\nimport { mapState } from \"vuex\";\n// import $ from \"jquery\";\n\nexport default {\n  name: \"MessageBox\",\n  mixins: [emptyImageFilter, fromNowFilter],\n  components: { Spinner },\n  props: {\n    currentChat: {\n      type: Object,\n      default: function () {\n        return {\n          userId: undefined,\n          name: \"\",\n          account: \"\",\n        };\n      },\n    },\n    messageList: {\n      type: Array,\n      required: true,\n    },\n    atPublic: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      message: \"\",\n      isProcessing: false,\n    };\n  },\n  updated() {\n    this.updateScroll();\n  },\n  methods: {\n    messageCheck(message) {\n      if (!message.length) {\n        Toast.fire({\n          icon: \"error\",\n          title: \"尚未輸入訊息!\",\n        });\n        return false;\n      }\n      return true;\n    },\n    sendMessageHandler: function () {\n      const message = this.message;\n      const messageCheckResult = this.messageCheck(message);\n      if (!messageCheckResult) {\n        return;\n      }\n\n      const newMessage = !this.messageList.length;\n      console.log(\"atPublic: \" + this.atPublic);\n\n      const messageMode = this.atPublic\n        ? \"chat message\"\n        : \"private chat message\";\n\n      this.sendMessage(messageMode, message, newMessage);\n\n      this.message = \"\";\n\n      Toast.fire({\n        icon: \"success\",\n        title: \"訊息已發送!\",\n      });\n    },\n    sendMessage(messageMode, message, newMessage) {\n      console.log(\"messageMode: \" + messageMode);\n      console.log(\"message: \" + message);\n      console.log(\"newMessage: \" + newMessage);\n      return this.$socket.emit(\n        messageMode,\n        {\n          roomId: this.currentRoomId,\n          newMessage,\n          message,\n        },\n        () => {\n          console.log(\"currentRoomId: \" + this.currentRoomId);\n          console.log(`chat message, new: ${newMessage}`);\n        }\n      );\n    },\n    toggleIsProcessing() {\n      this.isProcessing = !this.isProcessing;\n    },\n    updateScroll() {\n      this.$refs.messageList.scrollTop = this.$refs.messageList.scrollHeight;\n    },\n  },\n  watch: {\n    currentRoomId() {\n      console.log(\"new currentRoomId: \" + this.currentRoomId);\n    },\n  },\n  computed: {\n    ...mapState([\"currentUser\", \"currentRoomId\"]),\n  },\n};\n</script>\n\n<style scoped>\n.messageBox {\n  flex: 2;\n}\n.messageBox .title {\n  border-bottom: 1px solid #e6ecf0;\n  height: 55px;\n  padding: 10px 15px;\n  display: flex;\n  align-items: center;\n  position: sticky;\n  top: 0;\n  background-color: var(--white);\n  z-index: 1;\n}\n\n.messageBox .private {\n  display: block;\n  padding: 0;\n  padding-left: 10px;\n}\n\n.private h1 {\n  height: 50%;\n  line-height: 35px;\n}\n.private p {\n  margin: 0;\n  padding: 0;\n  height: 50%;\n}\n.title h1 {\n  font-weight: 700;\n  font-size: 19px;\n  margin: 0;\n}\n\n.noChat {\n  height: 55px;\n  display: flex;\n  align-items: center;\n}\n\n.noChat h1 {\n  /* margin-top: 20px; */\n  display: inline-block;\n}\n\n/* message box */\n\n.messageBox .container {\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  height: calc(100vh - 115px);\n  overflow-y: scroll;\n}\n\n.avatar {\n  width: 50px;\n  height: 50px;\n  border: 1px solid var(--white);\n  border-radius: 50%;\n}\n.avatar img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n\n.messageBox .container::-webkit-scrollbar {\n  display: none;\n}\n\n/* for Chrome, Safari and Opera */\n.messageBox .container {\n  -ms-overflow-style: none;\n}\n\n.messageList {\n  flex: 1;\n  margin: 0;\n  /* min-height: 100%; */\n}\n\n.messageList .emptyList {\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.messageList .emptyList img {\n  min-width: 5%;\n  width: 50px;\n  height: 50px;\n}\n\n.mainContent {\n  max-width: 60%;\n  /* width: 200px; */\n  /* height: 50px; */\n  margin: 10px 10px 0 10px;\n  display: flex;\n  align-items: flex-end;\n}\n.textTime {\n  margin-left: 70px;\n  color: #777;\n  font-weight: 500;\n}\n.messageItem .avatar {\n  min-width: 50px;\n  height: 50px;\n}\n.messageItem .textContainer {\n  word-break: break-all;\n  margin-left: 10px;\n  height: 100%;\n}\n.messageItem .textContainer .text {\n  padding: 10px 15px;\n  border-radius: 20px 20px 20px 0;\n  background: #e6ecf0;\n  font-size: 16px;\n}\n.actionItem {\n  margin: 10px;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n}\n.actionItem p {\n  margin: 0;\n  width: auto;\n  background-color: hsl(0deg 0% 90%);\n  color: hsl(207deg 14% 46%);\n  padding: 5px 10px;\n  border-radius: 10px;\n  font-weight: 500;\n}\n/*////////// currentUser's message ///////////*/\n.currentUser {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n}\n.currentUser .textContainer .text {\n  border-radius: 20px 20px 0 20px;\n  background-color: hsl(24deg 100% 50%);\n  color: var(--white);\n}\n.currentUser .textTime {\n  margin: 0;\n  margin: 10px 10px 0;\n}\n\n.currentUser .mainContent .avatar {\n  display: none;\n}\n\n.currentUser .textTime {\n}\n\n/*/ ////////////////// panel ///////////////*/\n.meesagePanel {\n  height: 60px;\n  padding: 10px;\n  display: flex;\n  border: 1px solid #e6ecf0;\n}\n#textInput {\n  flex: 1;\n  height: 40px;\n  outline: none;\n  border: none;\n  padding: 10px;\n  background: #e6ecf0;\n  border-radius: 10px;\n  font-size: 18px;\n  font-weight: 500;\n}\n.sendBtn {\n  width: 40px;\n  height: 40px;\n  padding: 0;\n  padding-right: 10px;\n  margin-left: 10px;\n}\n\n.sendBtn img {\n  transform: rotate(45deg);\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MessageBox.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MessageBox.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MessageBox.vue?vue&type=template&id=46389459&scoped=true&\"\nimport script from \"./MessageBox.vue?vue&type=script&lang=js&\"\nexport * from \"./MessageBox.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MessageBox.vue?vue&type=style&index=0&id=46389459&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"46389459\",\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/conversation.3c1553d6.svg\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MessageBox.vue?vue&type=style&index=0&id=46389459&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"publicMessage flex\"},[_c('UserSidebar'),_c('div',{staticClass:\"mainSection flex\"},[_c('div',{staticClass:\"usersOnline\"},[_c('div',{staticClass:\"title stickyTitle\"},[_c('h1',[_vm._v(\"上線使用者 (\"+_vm._s(_vm.onlineUsersCount)+\")\")])]),_c('div',{staticClass:\"container\"},[_c('ul',{staticClass:\"userList\"},[(_vm.isProcessing)?_c('Spinner'):_vm._e(),_vm._l((_vm.onlineUsers),function(user){return _c('li',{key:user.id,staticClass:\"userItem\"},[_c('div',{staticClass:\"userContainer\"},[_c('div',{staticClass:\"avatar\"},[_c('img',{attrs:{\"src\":_vm._f(\"emptyImageFilter\")(user.avatar),\"alt\":\"\"}})]),_c('div',{staticClass:\"userName\"},[_c('p',[_vm._v(_vm._s(user.name))])]),_c('div',{staticClass:\"userAccount\"},[_c('p',[_vm._v(\"@\"+_vm._s(user.account))])])])])})],2)])]),_c('MessageBox',{ref:\"messageBox\",attrs:{\"currentChat\":_vm.currentChat,\"atPublic\":_vm.atPublic,\"messageList\":_vm.messageList}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"publicMessage flex\">\n    <!-- UserSidebar -->\n    <UserSidebar></UserSidebar>\n\n    <!-- mainSection -->\n    <div class=\"mainSection flex\">\n      <!-- onlineUserList -->\n      <div class=\"usersOnline\">\n        <div class=\"title stickyTitle\">\n          <h1>上線使用者 ({{ onlineUsersCount }})</h1>\n        </div>\n        <div class=\"container\">\n          <ul class=\"userList\">\n            <Spinner v-if=\"isProcessing\"></Spinner>\n            <!-- userItem -->\n            <!-- other users -->\n            <li class=\"userItem\" v-for=\"user in onlineUsers\" :key=\"user.id\">\n              <div class=\"userContainer\">\n                <div class=\"avatar\">\n                  <img :src=\"user.avatar | emptyImageFilter\" alt=\"\" />\n                </div>\n                <div class=\"userName\">\n                  <p>{{ user.name }}</p>\n                </div>\n                <div class=\"userAccount\">\n                  <p>@{{ user.account }}</p>\n                </div>\n              </div>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <!-- messageBox -->\n      <MessageBox\n        ref=\"messageBox\"\n        :currentChat=\"currentChat\"\n        :atPublic=\"atPublic\"\n        :messageList=\"messageList\"\n      ></MessageBox>\n    </div>\n  </div>\n</template>\n\n<script>\nimport UserSidebar from \"../components/Common/UserSidebar\";\nimport MessageBox from \"../components/MessageBox\";\nimport Spinner from \"../components/Common/Spinner\";\nimport { fromNowFilter } from \"../utils/mixins\";\nimport { emptyImageFilter } from \"../utils/mixins\";\nimport { Toast } from \"../utils/helpers\";\nimport { mapState } from \"vuex\";\nimport sucketsAPI from \"../apis/socket\";\nexport default {\n  name: \"publicMessage\",\n  components: { UserSidebar, MessageBox, Spinner },\n  mixins: [emptyImageFilter, fromNowFilter],\n  data() {\n    return {\n      currentChat: {\n        userId: \"publicRoom\",\n        name: \"公開聊天室\",\n        account: \"\",\n      },\n      message: \"\",\n      messageList: [],\n      onlineUsersCount: 1,\n      onlineUsers: [],\n      atPublic: true,\n      isProcessing: true,\n    };\n  },\n  async mounted() {\n    // this.$socket.emit(\"leave\");\n    try {\n      this.isProcessing = true;\n      this.$refs.messageBox.toggleIsProcessing();\n      const { data } = await sucketsAPI.getPublicRoom();\n      const { messages, onlineUsersCount, onlineUsers } = data;\n      this.messageList = messages;\n      this.onlineUsers = onlineUsers;\n      this.onlineUsersCount = onlineUsersCount;\n\n      this.$refs.messageBox.toggleIsProcessing();\n      // join room\n      // this.joinPublicRoom();\n      this.isProcessing = false;\n    } catch (error) {\n      this.isProcessing = false;\n      console.log(error);\n      Toast.fire({\n        icon: \"error\",\n        // title: \"無法取得聊天室資料，請稍後再試！\",\n        title: error,\n      });\n    }\n  },\n  sockets: {\n    \"chat message\": function (data) {\n      console.log(\"Got message: \" + data.text);\n      this.messageList.push({\n        id: this.messageList + 1,\n        UserId: data.userId,\n        type: 1, // messageItem\n        avatar: data.avatar,\n        message: data.text,\n        createdAt: new Date(),\n      });\n    },\n    \"users count\": function (data) {\n      console.log(\"USERS COUNT!\");\n      const { users: onlineUsers, userCount: onlineUsersCount } = data;\n      this.onlineUsers = onlineUsers;\n      this.onlineUsersCount = onlineUsersCount;\n      this.message = \"\";\n    },\n    message: function (data) {\n      this.messageList.push({\n        id: this.messageList.length + 1,\n        type: 0, // actionItem\n        text: data.text,\n      });\n      this.message = \"\";\n    },\n  },\n  methods: {\n    // joinPublicRoom() {\n    //   // session update check\n    //   const { rooms } = JSON.parse(sessionStorage.getItem(\"rooms\"));\n    //   const sessionRoomId = rooms[2];\n    //   if (sessionRoomId !== \"4\") {\n    //     console.log(\"Session update needed!\");\n    //     this.$bus.$emit(\"updateSession\", 4);\n    //   }\n    //   console.log(\"No session update needed!\");\n    //   console.log(\"joinPublicRoom: id 4\");\n    //   this.$socket.emit(\"join\", {\n    //     userId: this.currentUser.id,\n    //     username: this.currentUser.name,\n    //     roomId: 4,\n    //   });\n    //   this.isProcessing = false;\n    // },\n  },\n  computed: {\n    ...mapState([\"currentUser\"]),\n  },\n};\n</script>\n\n<style scoped>\n.usersOnline {\n  border-right: 1px solid #e6ecf0;\n  flex: 1;\n}\n.usersOnline .title {\n  z-index: 1;\n}\n\n.usersOnline .container {\n  padding: 0;\n}\n\n.userItem .userContainer {\n  height: 60px;\n  border-bottom: 1px solid #e6ecf0;\n  display: flex;\n  align-items: center;\n  padding: 10px;\n}\n.avatar {\n  width: 50px;\n  height: 50px;\n  border: 1px solid var(--white);\n  border-radius: 50%;\n}\n.avatar img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n.userName {\n  height: 100%;\n  display: flex;\n  align-items: center;\n  margin: 0 0px 0 10px;\n}\n.userName p {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 700;\n}\n.userAccount {\n  height: 100%;\n  display: flex;\n  align-items: center;\n  margin: 0 10px;\n}\n.userAccount p {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 500;\n  color: #657786;\n}\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicMessage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicMessage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PublicMessage.vue?vue&type=template&id=3d63ecae&scoped=true&\"\nimport script from \"./PublicMessage.vue?vue&type=script&lang=js&\"\nexport * from \"./PublicMessage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PublicMessage.vue?vue&type=style&index=0&id=3d63ecae&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3d63ecae\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}