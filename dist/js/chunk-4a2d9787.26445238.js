(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a2d9787"],{"3bae":function(e,s,t){"use strict";var a=t("2fa3");s["a"]={getPublicRoom:function(){return a["b"].get("/rooms/4")},createPrivateRoom:function(e){return a["b"].post("/rooms",{userId:e})},getPrivateRoom:function(e){return a["b"].get("/rooms/".concat(e))},getNotification:function(){return a["b"].get("/rooms/notifications")},getRoom:function(e){return a["b"].get("/rooms/".concat(e))},getRoomsByUser:function(){return a["b"].get("/rooms")},getAvailableUsers:function(){return a["b"].get("rooms/availableUsers")},getUnread:function(){return a["b"].get("/private/unread")}}},"3fee":function(e,s,t){"use strict";t("f437")},4655:function(e,s,t){e.exports=t.p+"img/send.44ccdf6b.svg"},"521f":function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{staticClass:"messageBox"},[e.atPublic?[a("div",{staticClass:"title",on:{click:e.updateScroll}},[a("h1",[e._v("公開聊天室")])])]:[e.currentChat.name?a("div",{staticClass:"title private"},[a("h1",[e._v(e._s(e.currentChat.name?e.currentChat.name:"UserName"))]),a("p",[e._v("@"+e._s(e.currentChat.account?e.currentChat.account:"UserAccount"))])]):a("div",{staticClass:"title noChat"},[a("h1",[e._v("開啟聊天！")])])],a("div",{ref:"messageList",staticClass:"container"},[a("ul",{staticClass:"messageList"},[e.isProcessing?a("Spinner"):[e.messageList.length?e._l(e.messageList,(function(s){return[0===s.type?a("li",{key:s.id,staticClass:"actionItem"},[a("p",[e._v(e._s(s.text))])]):a("li",{key:s.id,staticClass:"messageItem",class:{currentUser:s.UserId===e.currentUser.id}},[a("div",{staticClass:"mainContent"},[a("div",{staticClass:"avatar"},[a("img",{attrs:{src:e._f("emptyImageFilter")(s.avatar),alt:""}})]),a("div",{staticClass:"textContainer"},[a("div",{staticClass:"text"},[e._v(" "+e._s(s.message)+" ")])])]),a("div",{staticClass:"textTime"},[e._v(e._s(e._f("fromNow")(s.createdAt)))])])]})):a("div",{staticClass:"emptyList"},[a("img",{attrs:{src:t("b8c3"),alt:""}})])]],2)]),a("div",{staticClass:"meesagePanel"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],attrs:{id:"textInput",placeholder:"輸入訊息...",type:"text",maxlength:"160",required:"",disabled:void 0===e.currentChat.userId},domProps:{value:e.message},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMessageHandler(s)},input:function(s){s.target.composing||(e.message=s.target.value)}}}),a("button",{staticClass:"btn sendBtn",attrs:{disabled:void 0===e.currentChat.userId,type:"submit"},on:{click:e.sendMessageHandler}},[a("img",{attrs:{src:t("4655"),alt:""}})])])],2)},n=[],i=t("5530"),r=t("b572"),o=t("2708"),c=t("2fa3"),u=t("2f62"),l={name:"MessageBox",mixins:[o["a"],o["c"]],components:{Spinner:r["a"]},props:{currentChat:{type:Object,default:function(){return{userId:void 0,name:"",account:""}}},messageList:{type:Array,required:!0},atPublic:{type:Boolean,default:!1}},data:function(){return{message:"",isProcessing:!1}},updated:function(){this.updateScroll()},methods:{messageCheck:function(e){return!!e.length||(c["a"].fire({icon:"error",title:"尚未輸入訊息!"}),!1)},sendMessageHandler:function(){var e=this.message,s=this.messageCheck(e);if(s){var t=!this.messageList.length;console.log("atPublic: "+this.atPublic);var a=this.atPublic?"chat message":"private chat message";this.sendMessage(a,e,t),this.message="",c["a"].fire({icon:"success",title:"訊息已發送!"})}},sendMessage:function(e,s,t){var a=this;return console.log("messageMode: "+e),console.log("message: "+s),console.log("newMessage: "+t),this.$socket.emit(e,{roomId:this.currentRoomId,newMessage:t,message:s},(function(){console.log("currentRoomId: "+a.currentRoomId),console.log("chat message, new: ".concat(t))}))},toggleIsProcessing:function(){this.isProcessing=!this.isProcessing},updateScroll:function(){this.$refs.messageList.scrollTop=this.$refs.messageList.scrollHeight}},watch:{currentRoomId:function(){console.log("new currentRoomId: "+this.currentRoomId)}},computed:Object(i["a"])({},Object(u["b"])(["currentUser","currentRoomId"]))},g=l,m=(t("f977"),t("2877")),d=Object(m["a"])(g,a,n,!1,null,"46389459",null);s["a"]=d.exports},"7c0d":function(e,s,t){},b8c3:function(e,s,t){e.exports=t.p+"img/conversation.3c1553d6.svg"},f437:function(e,s,t){},f977:function(e,s,t){"use strict";t("7c0d")},ffce:function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"publicMessage flex"},[t("UserSidebar"),t("div",{staticClass:"mainSection flex"},[t("div",{staticClass:"usersOnline"},[t("div",{staticClass:"title stickyTitle"},[t("h1",[e._v("上線使用者 ("+e._s(e.onlineUsersCount)+")")])]),t("div",{staticClass:"container"},[t("ul",{staticClass:"userList"},[e.isProcessing?t("Spinner"):e._e(),e._l(e.onlineUsers,(function(s){return t("li",{key:s.id,staticClass:"userItem"},[t("div",{staticClass:"userContainer"},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:e._f("emptyImageFilter")(s.avatar),alt:""}})]),t("div",{staticClass:"userName"},[t("p",[e._v(e._s(s.name))])]),t("div",{staticClass:"userAccount"},[t("p",[e._v("@"+e._s(s.account))])])])])}))],2)])]),t("MessageBox",{ref:"messageBox",attrs:{currentChat:e.currentChat,atPublic:e.atPublic,messageList:e.messageList}})],1)],1)},n=[],i=t("5530"),r=t("1da1"),o=(t("96cf"),t("c8e4")),c=t("521f"),u=t("b572"),l=t("2708"),g=t("2fa3"),m=t("2f62"),d=t("3bae"),f={name:"publicMessage",components:{UserSidebar:o["a"],MessageBox:c["a"],Spinner:u["a"]},mixins:[l["a"],l["c"]],data:function(){return{currentChat:{userId:"publicRoom",name:"公開聊天室",account:""},message:"",messageList:[],onlineUsersCount:1,onlineUsers:[],atPublic:!0,isProcessing:!0}},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var t,a,n,i,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isProcessing=!0,e.$refs.messageBox.toggleIsProcessing(),s.next=5,d["a"].getPublicRoom();case 5:t=s.sent,a=t.data,n=a.messages,i=a.onlineUsersCount,r=a.onlineUsers,e.messageList=n,e.onlineUsers=r,e.onlineUsersCount=i,e.$refs.messageBox.toggleIsProcessing(),e.isProcessing=!1,s.next=20;break;case 15:s.prev=15,s.t0=s["catch"](0),e.isProcessing=!1,console.log(s.t0),g["a"].fire({icon:"error",title:s.t0});case 20:case"end":return s.stop()}}),s,null,[[0,15]])})))()},sockets:{"chat message":function(e){console.log("Got message: "+e.text),this.messageList.push({id:this.messageList+1,UserId:e.userId,type:1,avatar:e.avatar,message:e.text,createdAt:new Date})},"users count":function(e){console.log("USERS COUNT!");var s=e.users,t=e.userCount;this.onlineUsers=s,this.onlineUsersCount=t,this.message=""},message:function(e){this.messageList.push({id:this.messageList.length+1,type:0,text:e.text}),this.message=""}},methods:{},computed:Object(i["a"])({},Object(m["b"])(["currentUser"]))},v=f,h=(t("3fee"),t("2877")),p=Object(h["a"])(v,a,n,!1,null,"3d63ecae",null);s["default"]=p.exports}}]);
//# sourceMappingURL=chunk-4a2d9787.26445238.js.map